<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schvalov√°n√≠ Projektov√© Dokumentace</title>
    <style>
        :root {
            --color-primary: #0066cc;
            --color-primary-dark: #004499;
            --color-success: #228B22;
            --color-warning: #ff9800;
            --color-danger: #d32f2f;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #212121;
            --color-text-light: #757575;
            --color-border: #e0e0e0;
            --border-radius: 8px;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--color-surface);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            color: var(--color-primary);
        }

        .subtitle {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: var(--color-text-light);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 20px;
            border-left: 4px solid var(--color-primary);
        }

        .card h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: var(--color-text);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 13px;
            color: var(--color-text);
        }

        input[type="text"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            background-color: #fafafa;
            color: var(--color-text);
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        input[type="file"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            background-color: var(--color-surface);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background-color: #e8e8e8;
        }

        .btn-danger {
            background-color: var(--color-danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #b71c1c;
        }

        .btn-success {
            background-color: var(--color-success);
            color: white;
        }

        .btn-success:hover {
            background-color: #1b5e20;
        }

        .user-list {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            max-height: 300px;
            overflow-y: auto;
        }

        .user-item {
            padding: 12px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fafafa;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item.active {
            background-color: #e8f4f8;
            border-left: 3px solid var(--color-primary);
        }

        .user-info {
            font-size: 13px;
        }

        .user-name {
            font-weight: 600;
            color: var(--color-text);
        }

        .user-role {
            font-size: 12px;
            color: var(--color-text-light);
        }

        .approval-step {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: #fafafa;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid var(--color-border);
        }

        .approval-step.pending {
            border-left-color: var(--color-warning);
            background-color: #fffbf0;
        }

        .approval-step.approved {
            border-left-color: var(--color-success);
            background-color: #f1f8f3;
        }

        .approval-step.current {
            border-left-color: var(--color-primary);
            background-color: #e8f4f8;
        }

        .step-order {
            font-weight: 600;
            font-size: 14px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .approval-step.approved .step-order {
            background-color: var(--color-success);
            color: white;
        }

        .approval-step.current .step-order {
            background-color: var(--color-primary);
            color: white;
        }

        .step-info {
            flex: 1;
            margin: 0 15px;
        }

        .step-user {
            font-weight: 600;
            font-size: 13px;
            color: var(--color-text);
        }

        .step-status {
            font-size: 12px;
            color: var(--color-text-light);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-badge.approved {
            background-color: #d4edda;
            color: #155724;
        }

        .status-badge.active {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .section-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--color-border);
        }

        .tab-btn {
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-light);
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .approval-workflow {
            background-color: var(--color-surface);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .status-info {
            background-color: #e8f4f8;
            padding: 15px;
            border-left: 4px solid var(--color-primary);
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .status-info.success {
            background-color: #f1f8f3;
            border-left-color: var(--color-success);
            color: var(--color-success);
        }

        .status-info.warning {
            background-color: #fffbf0;
            border-left-color: var(--color-warning);
            color: #e65100;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-light);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .document-info {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid var(--color-primary);
        }

        .document-info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px solid var(--color-border);
        }

        .document-info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--color-text);
        }

        .info-value {
            color: var(--color-text-light);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--color-border);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--color-success);
            transition: width 0.3s;
        }

        .section-divider {
            height: 1px;
            background-color: var(--color-border);
            margin: 20px 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            z-index: 1000;
            display: none;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left: 4px solid var(--color-success);
        }

        .notification.error {
            border-left: 4px solid var(--color-danger);
        }

        .notification.info {
            border-left: 4px solid var(--color-primary);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--color-border);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .help-text {
            font-size: 12px;
            color: var(--color-text-light);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Schvalov√°n√≠ Projektov√© Dokumentace</h1>
            <p class="subtitle">Extension pro Trimble Connect - spr√°va schvalovac√≠ch workflow</p>
        </header>

        <div class="section-tabs">
            <button class="tab-btn active" data-tab="setup">Nastaven√≠</button>
            <button class="tab-btn" data-tab="workflow">Workflow</button>
            <button class="tab-btn" data-tab="history">Historie</button>
        </div>

        <!-- SETUP TAB -->
        <div id="setup" class="tab-content active">
            <div class="main-grid">
                <!-- V√Ωbƒõr dokumentace -->
                <div class="card">
                    <h2>üìÅ V√Ωbƒõr Dokumentace</h2>
                    <div class="form-group">
                        <label for="projectFolderSelect">Slo≈æka s projektovou dokumentac√≠</label>
                        <select id="projectFolderSelect">
                            <option value="">-- Vyberte slo≈æku --</option>
                            <option value="folder_123">ProjektA - Studie</option>
                            <option value="folder_456">ProjektA - Projektov√° p≈ô√≠prava</option>
                            <option value="folder_789">ProjektB - V√Ωkazy</option>
                        </select>
                        <div class="help-text">Obsahuje soubory k schv√°len√≠</div>
                    </div>
                    <div class="form-group">
                        <label for="docDescription">Popis dokumentace</label>
                        <textarea id="docDescription" placeholder="Popi≈°te obsah dokumentace..."></textarea>
                    </div>
                    <div class="document-info" id="selectedDocInfo" style="display: none;">
                        <div class="document-info-item">
                            <span class="info-label">Slo≈æka:</span>
                            <span class="info-value" id="infoFolderName">-</span>
                        </div>
                        <div class="document-info-item">
                            <span class="info-label">Poƒçet soubor≈Ø:</span>
                            <span class="info-value" id="infoFileCount">0</span>
                        </div>
                        <div class="document-info-item">
                            <span class="info-label">Velikost:</span>
                            <span class="info-value" id="infoSize">0 MB</span>
                        </div>
                    </div>
                </div>

                <!-- V√Ωbƒõr schvaluj√≠c√≠ch -->
                <div class="card">
                    <h2>üë• Schvaluj√≠c√≠</h2>
                    <div class="form-group">
                        <label for="userList">Dostupn√≠ u≈æivatel√© projektu</label>
                        <div class="user-list" id="userList">
                            <div class="user-item" data-user-id="user_001">
                                <div class="user-info">
                                    <div class="user-name">Jan Nov√°k</div>
                                    <div class="user-role">Vedouc√≠ projektu</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="addApprover('user_001', 'Jan Nov√°k')">P≈ôidat</button>
                            </div>
                            <div class="user-item" data-user-id="user_002">
                                <div class="user-info">
                                    <div class="user-name">Marie Svobodov√°</div>
                                    <div class="user-role">Stavbyvedouc√≠</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="addApprover('user_002', 'Marie Svobodov√°')">P≈ôidat</button>
                            </div>
                            <div class="user-item" data-user-id="user_003">
                                <div class="user-info">
                                    <div class="user-name">Petr V√°clav</div>
                                    <div class="user-role">Bezpeƒçnostn√≠ mana≈æer</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="addApprover('user_003', 'Petr V√°clav')">P≈ôidat</button>
                            </div>
                            <div class="user-item" data-user-id="user_004">
                                <div class="user-info">
                                    <div class="user-name">Anna Kuƒçerov√°</div>
                                    <div class="user-role">Projektant</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="addApprover('user_004', 'Anna Kuƒçerov√°')">P≈ôidat</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Po≈ôad√≠ schvaluj√≠c√≠ch -->
            <div class="card">
                <h2>üî¢ Po≈ôad√≠ Schv√°len√≠</h2>
                <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 15px;">Schvaluj√≠c√≠ budou kontaktov√°ni v tomto po≈ôad√≠. Ka≈æd√Ω mus√≠ schv√°lit p≈ôedt√≠m, ne≈æ bude osloven dal≈°√≠.</p>
                <div id="approvalSequence">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>Zat√≠m nebyli p≈ôid√°ni ≈æ√°dn√≠ schvaluj√≠c√≠</p>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="startApprovalProcess()">
                        ‚ñ∂Ô∏è Spustit schvalovac√≠ proces
                    </button>
                    <button class="btn btn-secondary" onclick="clearApprovers()">
                        üóëÔ∏è Vymazat seznam
                    </button>
                </div>
            </div>
        </div>

        <!-- WORKFLOW TAB -->
        <div id="workflow" class="tab-content">
            <div class="approval-workflow">
                <h2 style="margin: 0 0 20px 0;">üìä Stav Schvalovac√≠ho Procesu</h2>
                
                <div id="noActiveWorkflow" class="empty-state">
                    <div class="empty-state-icon">üöÄ</div>
                    <p>Zat√≠m nebyl spu≈°tƒõn ≈æ√°dn√Ω schvalovac√≠ proces</p>
                    <p style="font-size: 12px;">Vra≈•te se na z√°lo≈æku <strong>Nastaven√≠</strong> a kliknƒõte na tlaƒç√≠tko <strong>Spustit schvalovac√≠ proces</strong></p>
                </div>

                <div id="activeWorkflow" style="display: none;">
                    <div class="status-info" id="workflowStatus"></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; font-size: 12px; color: var(--color-text-light);">
                        <span id="progressText">0 / 0 schv√°leno</span>
                        <span id="progressPercent">0%</span>
                    </div>

                    <div id="approvalSteps" style="margin-bottom: 20px;"></div>

                    <div class="section-divider"></div>

                    <h3 style="margin: 20px 0 15px 0;">Akce na Aktu√°ln√≠m Kroku</h3>
                    <div id="currentApproverActions" style="display: none;">
                        <div class="form-group">
                            <label for="approvalComment">Koment√°≈ô schvaluj√≠c√≠ho</label>
                            <textarea id="approvalComment" placeholder="Zadejte koment√°≈ô k schv√°len√≠ nebo zam√≠tnut√≠..."></textarea>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-success" onclick="approveDocument()">
                                ‚úì Schv√°lit Dokumentaci
                            </button>
                            <button class="btn btn-danger" onclick="rejectDocument()">
                                ‚úó Zam√≠tnout Dokumentaci
                            </button>
                        </div>
                    </div>

                    <div id="workflowComplete" style="display: none;">
                        <div class="status-info success">
                            ‚úì Schvalovac√≠ proces byl √∫spƒõ≈°nƒõ dokonƒçen! Dokumentace byla p≈ôesunuta do slo≈æky <strong>Schv√°len√©</strong>.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HISTORY TAB -->
        <div id="history" class="tab-content">
            <div class="card">
                <h2>üìú Historie Proces≈Ø</h2>
                <div id="historyList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>Zat√≠m nejsou k dispozici ≈æ√°dn√© procesy v historii</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // ============ STATE MANAGEMENT ============
        let appState = {
            selectedFolder: null,
            approvers: [],
            currentStep: 0,
            workflowActive: false,
            approvalHistory: [],
            workflowData: {
                folderId: null,
                description: null,
                startTime: null,
                approvers: [],
                completedSteps: []
            }
        };

        // ============ UTILITIES ============
        function showNotification(message, type = 'info') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification ${type} show`;
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        function formatDate(date) {
            return new Date(date).toLocaleString('cs-CZ');
        }

        // ============ APPROVER MANAGEMENT ============
        function addApprover(userId, userName) {
            if (!appState.approvers.find(a => a.id === userId)) {
                appState.approvers.push({
                    id: userId,
                    name: userName,
                    status: 'pending',
                    timestamp: null,
                    comment: ''
                });
                updateApprovalSequence();
                showNotification(`${userName} p≈ôid√°n/a do schvalovac√≠ho ≈ôetƒõzce`, 'success');
            }
        }

        function removeApprover(index) {
            const removed = appState.approvers.splice(index, 1)[0];
            updateApprovalSequence();
            showNotification(`${removed.name} byl/a odebr√°n/a ze schvalovac√≠ho ≈ôetƒõzce`, 'info');
        }

        function updateApprovalSequence() {
            const container = document.getElementById('approvalSequence');
            
            if (appState.approvers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>Zat√≠m nebyli p≈ôid√°ni ≈æ√°dn√≠ schvaluj√≠c√≠</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = appState.approvers.map((approver, index) => `
                <div class="approval-step ${appState.workflowActive && index === appState.currentStep ? 'current' : 'pending'}">
                    <div class="step-order">${index + 1}</div>
                    <div class="step-info">
                        <div class="step-user">${approver.name}</div>
                        <div class="step-status" id="step-status-${approver.id}">ƒåek√° na schv√°len√≠</div>
                    </div>
                    <span class="status-badge ${appState.workflowActive && index === appState.currentStep ? 'active' : 'pending'}">
                        ${appState.workflowActive && index === appState.currentStep ? 'Aktu√°lnƒõ na ≈ôadƒõ' : 'ƒåek√°'}
                    </span>
                    <button class="btn btn-secondary btn-sm" onclick="removeApprover(${index})" 
                        ${appState.workflowActive ? 'disabled' : ''}>Odebrat</button>
                </div>
            `).join('');
        }

        function clearApprovers() {
            if (appState.workflowActive) {
                showNotification('Bƒõhem prob√≠haj√≠c√≠ho procesu nelze zmƒõnit seznam schvaluj√≠c√≠ch', 'warning');
                return;
            }
            appState.approvers = [];
            updateApprovalSequence();
            showNotification('Seznam schvaluj√≠c√≠ch byl vymaz√°n', 'info');
        }

        // ============ WORKFLOW MANAGEMENT ============
        function startApprovalProcess() {
            const folderSelect = document.getElementById('projectFolderSelect').value;
            const description = document.getElementById('docDescription').value;

            if (!folderSelect) {
                showNotification('Vyberte pros√≠m slo≈æku s dokumentac√≠', 'error');
                return;
            }

            if (appState.approvers.length === 0) {
                showNotification('P≈ôidejte alespo≈à jednoho schvaluj√≠c√≠ho', 'error');
                return;
            }

            // Inicializace workflow
            appState.workflowActive = true;
            appState.currentStep = 0;
            appState.workflowData = {
                folderId: folderSelect,
                description: description,
                startTime: new Date(),
                approvers: [...appState.approvers],
                completedSteps: []
            };

            // Skryt√≠ setup, zobrazen√≠ workflow
            document.getElementById('setup').classList.remove('active');
            document.getElementById('workflow').classList.add('active');
            document.querySelector('[data-tab="setup"]').classList.remove('active');
            document.querySelector('[data-tab="workflow"]').classList.add('active');

            // Inicializace prvn√≠ho schvaluj√≠c√≠ho
            initializeCurrentStep();
            updateWorkflowUI();
            showNotification('Schvalovac√≠ proces byl zah√°jen! BCF notifikace byla odesl√°na prvn√≠mu schvaluj√≠c√≠mu.', 'success');
        }

        function initializeCurrentStep() {
            const approver = appState.approvers[appState.currentStep];
            if (approver) {
                // Simulace vytvo≈ôen√≠ BCF s notifikac√≠
                const bcfData = {
                    uuid: 'bcf-' + Date.now(),
                    title: `Schv√°len√≠ dokumentace - Krok ${appState.currentStep + 1}`,
                    assignedTo: approver.name,
                    priority: 'high',
                    description: appState.workflowData.description || 'Schv√°len√≠ projektov√© dokumentace'
                };
                console.log('BCF Topics Service - Vytvo≈ôen√≠:', bcfData);
                // V re√°ln√© aplikaci by se zde volala Topics API
            }
        }

        function updateWorkflowUI() {
            const completed = appState.approvers.filter(a => a.status === 'approved').length;
            const total = appState.approvers.length;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('noActiveWorkflow').style.display = 'none';
            document.getElementById('activeWorkflow').style.display = 'block';

            // Status zpr√°va
            const currentApprover = appState.approvers[appState.currentStep];
            document.getElementById('workflowStatus').innerHTML = `
                Aktu√°lnƒõ ƒçek√° na schv√°len√≠: <strong>${currentApprover.name}</strong>
            `;

            // Progress bar
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${completed} / ${total} schv√°leno`;
            document.getElementById('progressPercent').textContent = percentage + '%';

            // Approval steps
            const stepsHtml = appState.approvers.map((approver, index) => `
                <div class="approval-step ${approver.status === 'approved' ? 'approved' : index === appState.currentStep ? 'current' : 'pending'}">
                    <div class="step-order">${index + 1}</div>
                    <div class="step-info">
                        <div class="step-user">${approver.name}</div>
                        <div class="step-status">
                            ${approver.status === 'approved' ? '‚úì Schv√°leno' : index === appState.currentStep ? '‚è≥ ƒåek√° na schv√°len√≠' : '‚óã V≈Øƒçi ƒçek√°'}
                            ${approver.timestamp ? ` - ${formatDate(approver.timestamp)}` : ''}
                        </div>
                        ${approver.comment ? `<div class="step-status" style="color: var(--color-text); margin-top: 4px;"><strong>Koment√°≈ô:</strong> "${approver.comment}"</div>` : ''}
                    </div>
                    <span class="status-badge ${approver.status === 'approved' ? 'approved' : index === appState.currentStep ? 'active' : 'pending'}">
                        ${approver.status === 'approved' ? '‚úì Schv√°leno' : index === appState.currentStep ? '‚è≥ Aktu√°lnƒõ' : '‚óã ƒåek√°'}
                    </span>
                </div>
            `).join('');
            document.getElementById('approvalSteps').innerHTML = stepsHtml;

            // Actions
            if (appState.currentStep < appState.approvers.length && appState.approvers[appState.currentStep].status !== 'approved') {
                document.getElementById('currentApproverActions').style.display = 'block';
                document.getElementById('workflowComplete').style.display = 'none';
            } else if (completed === total) {
                document.getElementById('currentApproverActions').style.display = 'none';
                document.getElementById('workflowComplete').style.display = 'block';
                document.getElementById('approvalComment').value = '';
            }

            updateApprovalSequence();
        }

        function approveDocument() {
            const comment = document.getElementById('approvalComment').value;
            const approver = appState.approvers[appState.currentStep];

            approver.status = 'approved';
            approver.timestamp = new Date();
            approver.comment = comment;

            console.log('BCF Topics Service - Oznaƒçen√≠ jako vy≈ôe≈°eno:', approver.id);

            showNotification(`${approver.name} schv√°lil/a dokumentaci${comment ? ' s koment√°≈ôem' : ''}`, 'success');

            // P≈ôesun na dal≈°√≠ schvaluj√≠c√≠ho
            if (appState.currentStep < appState.approvers.length - 1) {
                appState.currentStep++;
                initializeCurrentStep();
                showNotification(`Notifikace byla odesl√°na u≈æivateli ${appState.approvers[appState.currentStep].name}`, 'info');
            } else {
                // Fin√°ln√≠ schv√°len√≠ - p≈ôesun slo≈æky
                console.log('P≈ôesun slo≈æky do Schv√°len√©');
                completeWorkflow();
            }

            document.getElementById('approvalComment').value = '';
            updateWorkflowUI();
        }

        function rejectDocument() {
            const comment = document.getElementById('approvalComment').value;
            
            if (!comment) {
                showNotification('P≈ôi zam√≠tnut√≠ mus√≠te zadat koment√°≈ô s d≈Øvodem', 'error');
                return;
            }

            const approver = appState.approvers[appState.currentStep];
            approver.status = 'rejected';
            approver.timestamp = new Date();
            approver.comment = comment;

            console.log('BCF Topics Service - Oznaƒçen√≠ jako zam√≠tnut√©:', approver.id);

            showNotification(`Dokumentace byla zam√≠tnuta u≈æivatelem ${approver.name}`, 'warning');
            completeWorkflow(true);
            updateWorkflowUI();
        }

        function completeWorkflow(rejected = false) {
            appState.workflowActive = false;
            
            // Ulo≈æit do historie
            appState.approvalHistory.push({
                id: 'proc-' + Date.now(),
                folderId: appState.workflowData.folderId,
                description: appState.workflowData.description,
                startTime: appState.workflowData.startTime,
                endTime: new Date(),
                approvers: appState.workflowData.approvers,
                status: rejected ? 'rejected' : 'approved'
            });

            updateHistoryList();

            if (!rejected) {
                showNotification('Dokumentace byla √∫spƒõ≈°nƒõ schv√°lena v≈°emi u≈æivateli!', 'success');
            }
        }

        // ============ HISTORY ============
        function updateHistoryList() {
            const container = document.getElementById('historyList');

            if (appState.approvalHistory.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>Zat√≠m nejsou k dispozici ≈æ√°dn√© procesy v historii</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = appState.approvalHistory.map(process => {
                const duration = Math.round((process.endTime - process.startTime) / 1000 / 60);
                return `
                    <div style="background-color: #f9f9f9; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid ${process.status === 'approved' ? 'var(--color-success)' : 'var(--color-danger)'};">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong>${process.description || 'Bez popisu'}</strong>
                            <span class="status-badge ${process.status === 'approved' ? 'approved' : 'pending'}">${process.status === 'approved' ? '‚úì Schv√°leno' : '‚úó Zam√≠tnut√≠'}</span>
                        </div>
                        <div style="font-size: 12px; color: var(--color-text-light);">
                            <div>Spu≈°teno: ${formatDate(process.startTime)}</div>
                            <div>Trv√°n√≠: ${duration} minut</div>
                            <div>Poƒçet schvaluj√≠c√≠ch: ${process.approvers.length}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============ TAB NAVIGATION ============
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tabName = e.target.dataset.tab;
                
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                
                e.target.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });

        // ============ FOLDER SELECTION ============
        document.getElementById('projectFolderSelect').addEventListener('change', (e) => {
            if (e.target.value) {
                const folderNames = {
                    'folder_123': 'ProjektA - Studie',
                    'folder_456': 'ProjektA - Projektov√° p≈ô√≠prava',
                    'folder_789': 'ProjektB - V√Ωkazy'
                };
                
                document.getElementById('selectedDocInfo').style.display = 'block';
                document.getElementById('infoFolderName').textContent = folderNames[e.target.value];
                document.getElementById('infoFileCount').textContent = Math.floor(Math.random() * 20) + 5;
                document.getElementById('infoSize').textContent = (Math.random() * 50 + 10).toFixed(1) + ' MB';
            } else {
                document.getElementById('selectedDocInfo').style.display = 'none';
            }
        });

        // ============ INITIALIZATION ============
        console.log('Trimble Connect Dokumentace Workflow Extension - inicializov√°n');
        console.log('Dostupn√© API: Workspace API, Core Service, Topics Service (BCF 2.1)');
    </script>
</body>
</html>
